<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />

    

    

    <title>redux学习笔记 | 刚刚有梦想</title>
    <meta name="author" content="36.5C" />
    <meta name="keywords" content="" />
    <meta name="description" content="redux和react-redux学习笔记redux基本概念actionType：行为类型，定义action的类别，通常是一组常量action：行为，用户触发用于改变store中state的行为actionCreator：行为生成器，用于将输入信息（payload）包装成相应的action的对象payload：有效载荷，是触发action时输入信息的总称，一个对象reducer：行为处理器，store中用于处理action的函数，根据actionType返回相应的新的stateco..." />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no" />

    
    <link rel="alternate" href="/atom.xml" title="刚刚有梦想" type="application/atom+xml">
    
    

    <style type="text/css">
    @font-face {
        font-family: 'icomoon';
        src: url("/fonts/icomoon.eot?q628ml");
        src: url("/fonts/icomoon.eot?q628ml#iefix") format('embedded-opentype'),
             url("/fonts/icomoon.ttf?q628ml") format('truetype'),
             url("/fonts/icomoon.woff?q628ml") format('woff'),
             url("/fonts/icomoon.svg?q628ml#icomoon") format('svg');
        font-weight: normal;
        font-style: normal;
    }
    </style>
    
<link rel="stylesheet" href="/css/style.css">


    <!--[if lt IE 9]>
    <style type="text/css">
    .nav-inner {top:0;}
    .author-meta {position:static;top:0;}
    .search-form {height:36px;}
    </style>
    <script type="text/javascript" src="https://unpkg.com/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
    <![endif]-->
<meta name="generator" content="Hexo 4.2.0"></head>
<body>

    <main class="app">
        <header id="header" class="header clearfix">
    <div id="nav" class="nav">
    <div class="nav-mobile">
        <button id="open-panel" class="open-panel nav-mobile-item"><i class="icon-documents"></i></button>
        <h1 class="nav-mobile-title nav-mobile-item">刚刚有梦想</h1>
        <button id="open-menus" class="open-panel nav-mobile-item"><i class="icon-library"></i></button>
    </div>

    <nav id="nav-inner" class="nav-inner">
        
            <a class="nav-item" href="/">
                <span class="nav-text">首页</span>
            </a>
        
            <a class="nav-item" href="/categories/front-end">
                <span class="nav-text">前端</span>
            </a>
        
            <a class="nav-item" href="/categories/back-end">
                <span class="nav-text">后端</span>
            </a>
        
            <a class="nav-item" href="/categories/other">
                <span class="nav-text">其他</span>
            </a>
        
            <a class="nav-item" href="/tags">
                <span class="nav-text">标签</span>
            </a>
        
            <a class="nav-item" href="/archives">
                <span class="nav-text">归档</span>
            </a>
        
            <a class="nav-item" href="/atom.xml">
                <span class="nav-text">订阅</span>
            </a>
        
            <a class="nav-item" href="/about">
                <span class="nav-text">关于</span>
            </a>
        
    </nav>
</div>

    <aside id="aside" class="aside">
    <div id="aside-mask" class="aside-mask"></div>
    <div id="aside-inner" class="aside-inner">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit"><i class="icon-search-stroke"></i></button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>

        
        
        
        

        
        <ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#redux"><span class="toc-number">1.</span> <span class="toc-text">redux</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#基本概念"><span class="toc-number">1.1.</span> <span class="toc-text">基本概念</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#与flex的关系"><span class="toc-number">1.2.</span> <span class="toc-text">与flex的关系</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#三大原则"><span class="toc-number">1.3.</span> <span class="toc-text">三大原则</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#搭建redux"><span class="toc-number">1.4.</span> <span class="toc-text">搭建redux</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#react-redux"><span class="toc-number">2.</span> <span class="toc-text">react-redux</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#全局注入store"><span class="toc-number">2.1.</span> <span class="toc-text">全局注入store</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#使组件具备访问和操作store能力"><span class="toc-number">2.2.</span> <span class="toc-text">使组件具备访问和操作store能力</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#类组件与react-redux"><span class="toc-number">2.2.1.</span> <span class="toc-text">类组件与react-redux</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#函数组件与react-redux"><span class="toc-number">2.2.2.</span> <span class="toc-text">函数组件与react-redux</span></a></li></ol></li></ol></li></ol>
        
    </div>
</aside>

</header>

        <div id="content" class="content">
            <div id="wrapper" class="wrapper" style="max-width: 800px">
                <article class="article" itemscope itemprop="blogPost">
    
    <header class="article-header">
        
        <h1 itemprop="name">
            redux学习笔记
        </h1>
        
        <div class="article-meta clearfix">
            <a class="article-date" href="http://yoursite.com/2021/03/17/redux%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/index.html">
    
    <i class="icon-calendar"></i>
    
    <time datetime="2021-03-17T03:00:02.000Z" itemprop="datePublished">2021-03-17</time>
</a>

            
<div class="article-tag-list">
    <i class="icon-tag"></i>
    <a class="article-tag-link" href="/tags/react/" rel="tag">react</a>, <a class="article-tag-link" href="/tags/react-redux/" rel="tag">react-redux</a>, <a class="article-tag-link" href="/tags/redux/" rel="tag">redux</a>
</div>


        </div>
    </header>
    
    <section class="article-body markdown-body">
        
        <p>redux和react-redux学习笔记</p>
<a id="more"></a>

<h4 id="redux"><a href="#redux" class="headerlink" title="redux"></a>redux</h4><h5 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h5><p>actionType：行为类型，定义action的类别，通常是一组常量<br>action：行为，用户触发用于改变store中state的行为<br>actionCreator：行为生成器，用于将输入信息（payload）包装成相应的action的对象<br>payload：有效载荷，是触发action时输入信息的总称，一个对象<br>reducer：行为处理器，store中用于处理action的函数，根据actionType返回相应的新的state</p>
<p>combineReducers：redux API，用于合并reducer，传入store中</p>
<p>示例项目目录：<br><img src="http://tva1.sinaimg.cn/large/007gxmUjly1gop78uxrpgj30fc09875r.jpg" alt="微信截图_20210319143021.png"></p>
<h5 id="与flex的关系"><a href="#与flex的关系" class="headerlink" title="与flex的关系"></a>与flex的关系</h5><p>由flex的演变而来<br>flex定义:</p>
<ol>
<li>应用的状态必须独立出来放到 store 里面统一管理</li>
<li>视图层组件不允许直接修改应用状态，只能触发 action</li>
<li>单向数据流</li>
</ol>
<p>redux在flex基础上提出单一数据源的概念</p>
<p><strong>FSA</strong><br>action是有一个固定格式的，叫作FSA, Flux Standard Action(Flux标准动作)，格式会像下面这样，是个JavaScript的对象字面定义:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  type: <span class="string">'ADD_TODO'</span>,</span><br><span class="line">  payload: &#123;</span><br><span class="line">    text: <span class="string">'Do something.'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Action creator</strong><br><mark>Action creator的设计也是由Flux架构来的产物<br>但因为设计的不同，在Redux中的Action creator比在Flux更简单，它通常只用来返回Action对象而已</mark>，<br>当然它本身是个函数，在返回前是可以再针对返回的动作数据先进行运算或整理的</p>
<h5 id="三大原则"><a href="#三大原则" class="headerlink" title="三大原则"></a>三大原则</h5><p><mark>redux遵循三大原则</mark></p>
<ol>
<li><p>单一数据源<br>整个应用的 state 被储存在一棵 object tree 中，并且这个 object tree 只存在于唯一一个 store 中。</p>
</li>
<li><p>state是只读的<br>唯一改变 state 的方法就是触发 action，action 是一个用于描述已发生事件的普通对象。</p>
</li>
<li><p>使用纯函数来执行修改<br>为了描述 action 如何改变 state tree ，你需要编写 reducers。</p>
</li>
</ol>
<h5 id="搭建redux"><a href="#搭建redux" class="headerlink" title="搭建redux"></a>搭建redux</h5><p>安装：<br><code>npm i -S redux</code><br>项目结构：</p>
<p><strong>actionType</strong>:用户行为类型定义，通常是一组常量<br>示例：<br>actionType/blog.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//定义action常量</span></span><br><span class="line"><span class="comment">//增加帖子</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> ADD_BLOG = <span class="string">"ADD_BLOG "</span>;</span><br><span class="line"><span class="comment">//删除帖子</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> DEL_BLOG = <span class="string">"DEL_BLOG"</span>;</span><br><span class="line"><span class="comment">//更新帖子</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> UPDATE_BLOG = <span class="string">"UPDATE_BLOG"</span>;</span><br></pre></td></tr></table></figure>

<p><strong>actionCreator</strong>:行为生成器，用于将输入信息包装成一个固定的action<br>示例：<br>action/blogs.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//定义action</span></span><br><span class="line"><span class="comment">//增加帖子</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> addBlog = <span class="function">(<span class="params">title, text, id</span>) =&gt;</span> (&#123;</span><br><span class="line">  type: ADD_BLOG,</span><br><span class="line">  id,</span><br><span class="line">  title,</span><br><span class="line">  content: text,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//删除帖子</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> delBlog = <span class="function">(<span class="params">id</span>) =&gt;</span> (&#123;</span><br><span class="line">  type: DEL_BLOG,</span><br><span class="line">  id,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//更新帖子</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> updateBlog = <span class="function">(<span class="params">id, text</span>) =&gt;</span> (&#123;</span><br><span class="line">  type: UPDATE_BLOG,</span><br><span class="line">  content: text,</span><br><span class="line">  id,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>reducer</strong>:行为处理器，store通过reducer来处理用户触发的action，其内部不会直接更改state，而是根据actionType返回一个新的state对象，纯函数<br>示例：<br>reducer/blog.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ADD_BLOG, DEL_BLOG, UPDATE_BLOG &#125; <span class="keyword">from</span> <span class="string">"../actionType/blog"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//reduce:纯函数，不会直接修改状态，而是返回一个修改后的新的state，通过combineReducer可以合并多个reducer，store通过reducer来修改状态</span></span><br><span class="line"><span class="comment">//博客模块的reducer</span></span><br><span class="line"><span class="keyword">const</span> initBlogList = [</span><br><span class="line">  &#123;</span><br><span class="line">    id: <span class="number">1</span>,</span><br><span class="line">    title: <span class="string">"blog1"</span>,</span><br><span class="line">    content: <span class="string">"默认帖子1"</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    id: <span class="number">2</span>,</span><br><span class="line">    title: <span class="string">"blog2"</span>,</span><br><span class="line">    content: <span class="string">"默认帖子2"</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">];</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> blogs = <span class="function">(<span class="params">state = initBlogList, action</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">    <span class="comment">//添加帖子</span></span><br><span class="line">    <span class="keyword">case</span> ADD_BLOG:</span><br><span class="line">      <span class="keyword">return</span> [</span><br><span class="line">        ...state,</span><br><span class="line">        &#123;</span><br><span class="line">          id: action.id,</span><br><span class="line">          title: action.title,</span><br><span class="line">          content: action.content,</span><br><span class="line">        &#125;,</span><br><span class="line">      ];</span><br><span class="line">    <span class="comment">//删除帖子</span></span><br><span class="line">    <span class="keyword">case</span> DEL_BLOG:</span><br><span class="line">      <span class="keyword">let</span> newState = <span class="built_in">JSON</span>.parse(<span class="built_in">JSON</span>.stringify(state));</span><br><span class="line">      newState = newState.filter(<span class="function">(<span class="params">blog</span>) =&gt;</span> blog.id != action.id);</span><br><span class="line">      <span class="keyword">return</span> newState;</span><br><span class="line">    <span class="comment">//更新帖子</span></span><br><span class="line">    <span class="keyword">case</span> UPDATE_BLOG:</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">JSON</span>.parse(<span class="built_in">JSON</span>.stringify(state)).map(<span class="function">(<span class="params">blog</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (blog.id != action.id) &#123;</span><br><span class="line">          <span class="keyword">return</span> blog;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">return</span> &#123; ...blog, <span class="attr">content</span>: action.content &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    <span class="comment">//默认会返回数据（用于外部组件访问）</span></span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">return</span> state;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>combineReducers</strong>：redux的API，用于合并reducer，传入store中<br>示例：<br>reducer/index.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; combineReducers &#125; <span class="keyword">from</span> <span class="string">"redux"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; blogs &#125; <span class="keyword">from</span> <span class="string">"./blog"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; notes &#125; <span class="keyword">from</span> <span class="string">"./note"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//外部通过state.blogs访问初始状态，即通过reducer的注册名，不传action.type会默认返回state</span></span><br><span class="line"><span class="keyword">const</span> rootReducer = combineReducers(&#123; blogs, notes &#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> rootReducer;</span><br></pre></td></tr></table></figure>

<p><strong>store</strong>：全局状态管理器（有且仅有一个）<br>最后将reducer传入store<br>示例：<br>store/index.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//applyMiddleware是中间件，可以插入相应的插件</span></span><br><span class="line"><span class="keyword">import</span> &#123; createStore, applyMiddleware &#125; <span class="keyword">from</span> <span class="string">"redux"</span>;</span><br><span class="line"><span class="keyword">import</span> rootReducer <span class="keyword">from</span> <span class="string">"./reducer/index"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//import thunk from 'redux-thunk' 异步action中间件</span></span><br><span class="line"><span class="keyword">const</span> store = createStore(rootReducer);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store;</span><br></pre></td></tr></table></figure>

<h4 id="react-redux"><a href="#react-redux" class="headerlink" title="react-redux"></a>react-redux</h4><p>react-redux是redux和react沟通的桥梁<br>react提供了</p>
<ol>
<li><code>&lt;Provider&gt;</code>组件用于顶层（全局）注入store</li>
<li>提供了相应的API，使组件内部具备访问和操作store的数据的能力</li>
</ol>
<h5 id="全局注入store"><a href="#全局注入store" class="headerlink" title="全局注入store"></a>全局注入store</h5><p><code>&lt;Provide&gt;</code> 用于全局注入store<br>示例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Provider用于顶层注入store，便于各组件内使用</span></span><br><span class="line"><span class="keyword">import</span> &#123; Provider &#125; <span class="keyword">from</span> <span class="string">"react-redux"</span>;</span><br><span class="line"><span class="comment">//引入store</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">"./store"</span>;</span><br><span class="line">...</span><br><span class="line">ReactDOM.render(</span><br><span class="line">  &lt;React.StrictMode&gt;</span><br><span class="line">    &#123;<span class="comment">/* store顶层注入 */</span>&#125;</span><br><span class="line">    &lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">      &lt;Router&gt;</span><br><span class="line">        &#123;createRouteConfig()&#125;</span><br><span class="line">        &#123;<span class="comment">/* &lt;Route path="/" exact component=&#123;Layout&#125; /&gt;</span></span><br><span class="line"><span class="comment">      &lt;Route path="/login" component=&#123;Login&#125; /&gt; */</span>&#125;</span><br><span class="line">      &lt;<span class="regexp">/Router&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>Provider&gt;</span><br><span class="line">  &lt;<span class="regexp">/React.StrictMode&gt;,</span></span><br><span class="line"><span class="regexp">  document.getElementById("root")</span></span><br><span class="line"><span class="regexp">);</span></span><br></pre></td></tr></table></figure>

<h5 id="使组件具备访问和操作store能力"><a href="#使组件具备访问和操作store能力" class="headerlink" title="使组件具备访问和操作store能力"></a>使组件具备访问和操作store能力</h5><h6 id="类组件与react-redux"><a href="#类组件与react-redux" class="headerlink" title="类组件与react-redux"></a>类组件与react-redux</h6><p>提供conntent方法，将组件包装成容器组件，并提供将store的state和dispatch映射到容器组件的props上的入口</p>
<p><strong>mapStateToProps</strong><br>自定义state映射，该函数作为connect的第一个参数，能拿到state，映射store的state到组件的props上</p>
<p><strong>mapDispatchToProps</strong><br>自定义dispatch映射，该函数作为connect的第二个参数，能拿到dispatch，映射dispatch方法到组件的props上<br>示例：<br>actionType<br>store/actionType/blog.js:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//定义action常量</span></span><br><span class="line"><span class="comment">//增加帖子</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> ADD_BLOG = <span class="string">"ADD_BLOG "</span>;</span><br><span class="line"><span class="comment">//删除帖子</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> DEL_BLOG = <span class="string">"DEL_BLOG"</span>;</span><br><span class="line"><span class="comment">//更新帖子</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> UPDATE_BLOG = <span class="string">"UPDATE_BLOG"</span>;</span><br></pre></td></tr></table></figure>

<p>actionCreator<br>store/action/blog.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ADD_BLOG, DEL_BLOG, UPDATE_BLOG &#125; <span class="keyword">from</span> <span class="string">"../actionType/blog"</span>;</span><br><span class="line"><span class="comment">//定义action</span></span><br><span class="line"><span class="comment">//增加帖子</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> addBlog = <span class="function">(<span class="params">title, text, id</span>) =&gt;</span> (&#123;</span><br><span class="line">  type: ADD_BLOG,</span><br><span class="line">  id,</span><br><span class="line">  title,</span><br><span class="line">  content: text,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//删除帖子</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> delBlog = <span class="function">(<span class="params">id</span>) =&gt;</span> (&#123;</span><br><span class="line">  type: DEL_BLOG,</span><br><span class="line">  id,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//更新帖子</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> updateBlog = <span class="function">(<span class="params">id, text</span>) =&gt;</span> (&#123;</span><br><span class="line">  type: UPDATE_BLOG,</span><br><span class="line">  content: text,</span><br><span class="line">  id,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>reducer<br>store/reducer/blog.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ADD_BLOG, DEL_BLOG, UPDATE_BLOG &#125; <span class="keyword">from</span> <span class="string">"../actionType/blog"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//reduce:纯函数，不会直接修改状态，而是返回一个修改后的新的state，通过combineReducer可以合并多个reducer，store通过reducer来修改状态</span></span><br><span class="line"><span class="comment">//博客模块的reducer</span></span><br><span class="line"><span class="keyword">const</span> initBlogList = [</span><br><span class="line">  &#123;</span><br><span class="line">    id: <span class="number">1</span>,</span><br><span class="line">    title: <span class="string">"blog1"</span>,</span><br><span class="line">    content: <span class="string">"默认帖子1"</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    id: <span class="number">2</span>,</span><br><span class="line">    title: <span class="string">"blog2"</span>,</span><br><span class="line">    content: <span class="string">"默认帖子2"</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">];</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> blogs = <span class="function">(<span class="params">state = initBlogList, action</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">    <span class="comment">//添加帖子</span></span><br><span class="line">    <span class="keyword">case</span> ADD_BLOG:</span><br><span class="line">      <span class="keyword">return</span> [</span><br><span class="line">        ...state,</span><br><span class="line">        &#123;</span><br><span class="line">          id: action.id,</span><br><span class="line">          title: action.title,</span><br><span class="line">          content: action.content,</span><br><span class="line">        &#125;,</span><br><span class="line">      ];</span><br><span class="line">    <span class="comment">//删除帖子</span></span><br><span class="line">    <span class="keyword">case</span> DEL_BLOG:</span><br><span class="line">      <span class="keyword">let</span> newState = <span class="built_in">JSON</span>.parse(<span class="built_in">JSON</span>.stringify(state));</span><br><span class="line">      newState = newState.filter(<span class="function">(<span class="params">blog</span>) =&gt;</span> blog.id != action.id);</span><br><span class="line">      <span class="keyword">return</span> newState;</span><br><span class="line">    <span class="comment">//更新帖子</span></span><br><span class="line">    <span class="keyword">case</span> UPDATE_BLOG:</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">JSON</span>.parse(<span class="built_in">JSON</span>.stringify(state)).map(<span class="function">(<span class="params">blog</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (blog.id != action.id) &#123;</span><br><span class="line">          <span class="keyword">return</span> blog;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">return</span> &#123; ...blog, <span class="attr">content</span>: action.content &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    <span class="comment">//默认会返回数据（用于外部组件访问）</span></span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">return</span> state;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>store/reducer/index.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; combineReducers &#125; <span class="keyword">from</span> <span class="string">"redux"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; blogs &#125; <span class="keyword">from</span> <span class="string">"./blog"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; notes &#125; <span class="keyword">from</span> <span class="string">"./note"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//外部通过state.blogs访问初始状态，即通过reducer的注册名，不传action.type会默认返回state</span></span><br><span class="line"><span class="keyword">const</span> rootReducer = combineReducers(&#123; blogs, notes &#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> rootReducer;</span><br></pre></td></tr></table></figure>

<p>store<br>store/index.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//applyMiddleware是中间件，可以插入相应的插件</span></span><br><span class="line"><span class="keyword">import</span> &#123; createStore, applyMiddleware &#125; <span class="keyword">from</span> <span class="string">"redux"</span>;</span><br><span class="line"><span class="keyword">import</span> rootReducer <span class="keyword">from</span> <span class="string">"./reducer/index"</span>;</span><br><span class="line"><span class="comment">//import thunk from 'redux-thunk' 异步action中间件</span></span><br><span class="line"><span class="keyword">const</span> store = createStore(rootReducer);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store;</span><br></pre></td></tr></table></figure>

<p>src/index.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Provider用于顶层注入store，便于各组件内使用</span></span><br><span class="line"><span class="keyword">import</span> &#123; Provider &#125; <span class="keyword">from</span> <span class="string">"react-redux"</span>;</span><br><span class="line"><span class="comment">//引入store</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">"./store"</span>;</span><br><span class="line">...</span><br><span class="line">ReactDOM.render(</span><br><span class="line">  &lt;React.StrictMode&gt;</span><br><span class="line">    &#123;<span class="comment">/* store顶层注入 */</span>&#125;</span><br><span class="line">    &lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">      &lt;Router&gt;</span><br><span class="line">        &#123;createRouteConfig()&#125;</span><br><span class="line">        &#123;<span class="comment">/* &lt;Route path="/" exact component=&#123;Layout&#125; /&gt;</span></span><br><span class="line"><span class="comment">      &lt;Route path="/login" component=&#123;Login&#125; /&gt; */</span>&#125;</span><br><span class="line">      &lt;<span class="regexp">/Router&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>Provider&gt;</span><br><span class="line">  &lt;<span class="regexp">/React.StrictMode&gt;,</span></span><br><span class="line"><span class="regexp">  document.getElementById("root")</span></span><br><span class="line"><span class="regexp">);</span></span><br></pre></td></tr></table></figure>

<p>页面（类组件）<br>views/about/about.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">"react-redux"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; addBlog, delBlog, updateBlog &#125; <span class="keyword">from</span> <span class="string">"../../store/action/blog"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Button &#125; <span class="keyword">from</span> <span class="string">"antd"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> style <span class="keyword">from</span> <span class="string">"./about.module.css"</span>;</span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">"../../store"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//该函数作为connect的第一个参数，能拿到state</span></span><br><span class="line"><span class="comment">//映射store的state到组件的props上</span></span><br><span class="line"><span class="keyword">const</span> mapStateToProps = <span class="function">(<span class="params">state</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    blogList: state.blogs,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//该函数作为connect的第二个参数，能拿到dispatch</span></span><br><span class="line"><span class="comment">//映射dispatch方法到组件的props上</span></span><br><span class="line"><span class="keyword">const</span> mapDispatchToProps = <span class="function">(<span class="params">dispatch</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    addBlogMapProps(title, text, id) &#123;</span><br><span class="line">      dispatch(addBlog(title, text, id));</span><br><span class="line">    &#125;,</span><br><span class="line">    delBlogMapProps(id) &#123;</span><br><span class="line">      dispatch(delBlog(id));</span><br><span class="line">    &#125;,</span><br><span class="line">    updateBlogMapProps(id, text) &#123;</span><br><span class="line">      dispatch(updateBlog(id, text));</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//UI组件（内部不包含store的状态，但内部有state，不算是纯组件？？？？？）</span></span><br><span class="line"><span class="comment">//纯组件：输出取决于输入的props</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">About</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="comment">//初始化state</span></span><br><span class="line">    <span class="keyword">this</span>.state = &#123;&#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  addBlog = <span class="function">(<span class="params">title, text</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> blogList = <span class="keyword">this</span>.props.blogList;</span><br><span class="line">    <span class="keyword">let</span> newId = <span class="built_in">Number</span>(blogList[blogList.length - <span class="number">1</span>].id) + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">this</span>.props.addBlogMapProps(title + newId, text + newId, newId);</span><br><span class="line">  &#125;;</span><br><span class="line">  delBlog = <span class="function">(<span class="params">id</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.props.delBlogMapProps(id);</span><br><span class="line">  &#125;;</span><br><span class="line">  updateBlog = <span class="function">(<span class="params">id, text</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.props.updateBlogMapProps(id, text);</span><br><span class="line">  &#125;;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">let</span> listItems = <span class="keyword">this</span>.props.blogList.map(<span class="function">(<span class="params">blog, index</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> (</span><br><span class="line">        &lt;li key=&#123;index&#125;&gt;</span><br><span class="line">          &lt;div className=&#123;style[<span class="string">"blogCard_top"</span>]&#125;&gt;</span><br><span class="line">            &lt;span className=&#123;style.title&#125;&gt;标题：&#123;blog.title&#125;&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">            &lt;div style=&#123;&#123; float: "right" &#125;&#125;&gt;</span></span><br><span class="line"><span class="regexp">              &lt;Button</span></span><br><span class="line"><span class="regexp">                danger</span></span><br><span class="line"><span class="regexp">                type="text"</span></span><br><span class="line"><span class="regexp">                onClick=&#123;this.delBlog.bind(this, blog.id)&#125;</span></span><br><span class="line"><span class="regexp">              &gt;</span></span><br><span class="line"><span class="regexp">                删除帖子</span></span><br><span class="line"><span class="regexp">              &lt;/</span>Button&gt;</span><br><span class="line">              &lt;Button</span><br><span class="line">                danger</span><br><span class="line">                type=<span class="string">"text"</span></span><br><span class="line">                onClick=&#123;<span class="keyword">this</span>.updateBlog.bind(<span class="keyword">this</span>, blog.id, <span class="string">"修改了"</span>)&#125;</span><br><span class="line">              &gt;</span><br><span class="line">                修改帖子</span><br><span class="line">              &lt;<span class="regexp">/Button&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>div&gt;</span><br><span class="line">          &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">          &lt;span className=&#123;style.content&#125;&gt;内容：&#123;blog.content&#125;&lt;/</span>span&gt;</span><br><span class="line">        &lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">      );</span></span><br><span class="line"><span class="regexp">    &#125;);</span></span><br><span class="line"><span class="regexp">    return (</span></span><br><span class="line"><span class="regexp">      &lt;div&gt;</span></span><br><span class="line"><span class="regexp">        &lt;div&gt;帖子列表&lt;/</span>div&gt;</span><br><span class="line">        &lt;Button</span><br><span class="line">          type=<span class="string">"primary"</span></span><br><span class="line">          onClick=&#123;<span class="keyword">this</span>.addBlog.bind(<span class="keyword">this</span>, <span class="string">"新建帖子标题"</span>, <span class="string">"新建帖子内容"</span>)&#125;</span><br><span class="line">        &gt;</span><br><span class="line">          新建帖子</span><br><span class="line">        &lt;<span class="regexp">/Button&gt;</span></span><br><span class="line"><span class="regexp">        &lt;ul className=&#123;style.blogList&#125;&gt;&#123;listItems&#125;&lt;/u</span>l&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ export default About;</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/react-redux将UI组件变成容器组件，通过mapStateToProps，mapDispatchToProps将store映射到组件内</span></span><br><span class="line"><span class="regexp">export default connect(mapStateToProps, mapDispatchToProps)(About);</span></span><br></pre></td></tr></table></figure>

<p>这里react-redux<br>将所有组件分成两大类：UI 组件（presentational component，纯组件）和容器组件（container component）。</p>
<p>UI 组件有以下几个特征。</p>
<ul>
<li>只负责 UI 的呈现，不带有任何业务逻辑</li>
<li>没有状态（即不使用this.state这个变量）</li>
<li>所有数据都由参数（this.props）提供</li>
<li>不使用任何 Redux 的 API<br>示例：</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Title =</span><br><span class="line">  value =&gt; <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;value&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br></pre></td></tr></table></figure>

<p>因为不含有状态，UI 组件又称为”纯组件”，即它纯函数一样，纯粹由参数决定它的值。</p>
<p>容器组件的特征恰恰相反。</p>
<ul>
<li>负责管理数据和业务逻辑，不负责 UI 的呈现</li>
<li>带有内部状态</li>
<li>使用 redux 的 API</li>
</ul>
<p><mark>UI 组件负责 UI 的呈现，容器组件负责管理数据和逻辑。</mark><br>如果一个组件既有 UI 又有业务逻辑，则将它拆分成下面的结构：外面是一个容器组件，里面包了一个UI 组件。前者负责与外部的通信，将数据传给后者，由后者渲染出视图。</p>
<p><mark>react-redux 规定，所有的 UI 组件都由用户提供，容器组件则是由 react-redux 自动生成。也就是说，用户负责视觉层，状态管理则是全部交给它。</mark><br><mark>react-redux 提供connect方法，用于从 UI 组件生成容器组件。connect的意思，就是将这两种组件连起来。</mark></p>
<h6 id="函数组件与react-redux"><a href="#函数组件与react-redux" class="headerlink" title="函数组件与react-redux"></a>函数组件与react-redux</h6><p>提供了useSelector,userDispatch这两个hooks函数,useSelector可拿到state,useDispatch可以拿到dispatch<br>示例：<br>actionType<br>store/actionType/note.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//增加日记</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> ADD_NOTE = <span class="string">"ADD_NOTE"</span>;</span><br><span class="line"><span class="comment">//删除日记</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> DEL_NOTE = <span class="string">"DEL_NOTE"</span>;</span><br><span class="line"><span class="comment">//更新日记</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> UPDATE_NOTE = <span class="string">"UPDATE_NOTE"</span>;</span><br></pre></td></tr></table></figure>

<p>actionCreator<br>store/action/note.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ADD_NOTE, DEL_NOTE, UPDATE_NOTE &#125; <span class="keyword">from</span> <span class="string">"../actionType/note"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//增加日记</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>payload 格式：&#123;title,content,creator,date,id&#125;</span></span><br><span class="line"><span class="comment"> * title 标题 content 内容 creator 创建人 date 日期 id 帖子id</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> addNote = <span class="function">(<span class="params">payload</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    type: ADD_NOTE,</span><br><span class="line">    payload</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//删除日记</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>payload 格式：&#123;id&#125;</span></span><br><span class="line"><span class="comment"> * id 帖子id</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> delNote = <span class="function">(<span class="params">payload</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    type: DEL_NOTE,</span><br><span class="line">    payload</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//更新日记</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>payload 格式：&#123;id,title,content&#125;</span></span><br><span class="line"><span class="comment"> * title 标题 content 内容 id 帖子id</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> updateNote = <span class="function">(<span class="params">payload</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    type: UPDATE_NOTE,</span><br><span class="line">    payload</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>reducer<br>store/reducer/note.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ADD_NOTE, DEL_NOTE, UPDATE_NOTE &#125; <span class="keyword">from</span> <span class="string">"../actionType/note"</span>;</span><br><span class="line"><span class="keyword">const</span> initNoteList = [</span><br><span class="line">  &#123;</span><br><span class="line">    id: <span class="number">1</span>,</span><br><span class="line">    title: <span class="string">"日记1"</span>,</span><br><span class="line">    content: <span class="string">"内容"</span>,</span><br><span class="line">    creator: <span class="string">"强子"</span>,</span><br><span class="line">    date: <span class="string">"2020-12-20"</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">];</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> notes = <span class="function">(<span class="params">state = initNoteList, action</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">    <span class="comment">//增加日记</span></span><br><span class="line">    <span class="keyword">case</span> ADD_NOTE:</span><br><span class="line">      <span class="keyword">return</span> [...state, action.payload];</span><br><span class="line">    <span class="comment">//删除日记</span></span><br><span class="line">    <span class="keyword">case</span> DEL_NOTE:</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">JSON</span>.parse(<span class="built_in">JSON</span>.stringify(state)).filter(</span><br><span class="line">        (note) =&gt; note.id != action.payload.id</span><br><span class="line">      );</span><br><span class="line">    <span class="comment">//修改日记</span></span><br><span class="line">    <span class="keyword">case</span> UPDATE_NOTE:</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">JSON</span>.parse(<span class="built_in">JSON</span>.stringify(state)).map(<span class="function">(<span class="params">note</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (note.id != action.payload.id) &#123;</span><br><span class="line">          <span class="keyword">return</span> note;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">return</span> &#123;</span><br><span class="line">            ...note,</span><br><span class="line">            title: action.payload.title,</span><br><span class="line">            content: action.payload.content,</span><br><span class="line">          &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">return</span> state;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>store/reducer/index.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; combineReducers &#125; <span class="keyword">from</span> <span class="string">"redux"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; blogs &#125; <span class="keyword">from</span> <span class="string">"./blog"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; notes &#125; <span class="keyword">from</span> <span class="string">"./note"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//外部通过state.blogs访问初始状态，即通过reducer的注册名，不传action.type会默认返回state</span></span><br><span class="line"><span class="keyword">const</span> rootReducer = combineReducers(&#123; blogs, notes &#125;);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> rootReducer;</span><br></pre></td></tr></table></figure>

<p>store<br>store/index.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//applyMiddleware是中间件，可以插入相应的插件</span></span><br><span class="line"><span class="keyword">import</span> &#123; createStore, applyMiddleware &#125; <span class="keyword">from</span> <span class="string">"redux"</span>;</span><br><span class="line"><span class="keyword">import</span> rootReducer <span class="keyword">from</span> <span class="string">"./reducer/index"</span>;</span><br><span class="line"><span class="comment">//import thunk from 'redux-thunk' 异步action中间件</span></span><br><span class="line"><span class="keyword">const</span> store = createStore(rootReducer);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store;</span><br></pre></td></tr></table></figure>

<p>src/index.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Provider用于顶层注入store，便于各组件内使用</span></span><br><span class="line"><span class="keyword">import</span> &#123; Provider &#125; <span class="keyword">from</span> <span class="string">"react-redux"</span>;</span><br><span class="line"><span class="comment">//引入store</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">"./store"</span>;</span><br><span class="line">...</span><br><span class="line">  &lt;React.StrictMode&gt;</span><br><span class="line">    &#123;<span class="comment">/* store顶层注入 */</span>&#125;</span><br><span class="line">    &lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">      &lt;Router&gt;</span><br><span class="line">        &#123;createRouteConfig()&#125;</span><br><span class="line">        &#123;<span class="comment">/* &lt;Route path="/" exact component=&#123;Layout&#125; /&gt;</span></span><br><span class="line"><span class="comment">      &lt;Route path="/login" component=&#123;Login&#125; /&gt; */</span>&#125;</span><br><span class="line">      &lt;<span class="regexp">/Router&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>Provider&gt;</span><br><span class="line">  &lt;<span class="regexp">/React.StrictMode&gt;,</span></span><br><span class="line"><span class="regexp">  document.getElementById("root")</span></span><br><span class="line"><span class="regexp">);</span></span><br></pre></td></tr></table></figure>

<p>页面（函数组件）<br>views/note/note.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> style <span class="keyword">from</span> <span class="string">"./note.module.css"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; addNote, delNote, updateNote &#125; <span class="keyword">from</span> <span class="string">"../../store/action/note"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useSelector, useDispatch &#125; <span class="keyword">from</span> <span class="string">"react-redux"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Button &#125; <span class="keyword">from</span> <span class="string">"antd"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  SmileTwoTone,</span><br><span class="line">  HeartTwoTone,</span><br><span class="line">  CheckCircleTwoTone,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">"@ant-design/icons"</span>;</span><br><span class="line"><span class="comment">//函数组件</span></span><br><span class="line"><span class="keyword">let</span> Note = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//函数组件中react-redux使用react-hooks模式</span></span><br><span class="line">  <span class="comment">//将store的state和dispatch作为hooks引入</span></span><br><span class="line">  <span class="keyword">const</span> noteList = useSelector(<span class="function">(<span class="params">state</span>) =&gt;</span> state.notes);</span><br><span class="line">  <span class="comment">//柯里化</span></span><br><span class="line">  <span class="keyword">const</span> dispatch = useDispatch();</span><br><span class="line">  <span class="comment">//增加日记</span></span><br><span class="line">  <span class="keyword">const</span> addNoteHandler = <span class="function">(<span class="params">title, content</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> newId = <span class="built_in">Number</span>(noteList[noteList.length - <span class="number">1</span>].id) + <span class="number">1</span>;</span><br><span class="line">    title = title + newId;</span><br><span class="line">    content = content + newId;</span><br><span class="line">    <span class="keyword">let</span> creator = <span class="string">"小强"</span>;</span><br><span class="line">    <span class="keyword">let</span> date = <span class="string">"2020-12-23"</span>;</span><br><span class="line">    dispatch(</span><br><span class="line">      addNote(&#123;</span><br><span class="line">        id: newId,</span><br><span class="line">        title,</span><br><span class="line">        content,</span><br><span class="line">        creator,</span><br><span class="line">        date,</span><br><span class="line">      &#125;)</span><br><span class="line">    );</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">//删除日记</span></span><br><span class="line">  <span class="keyword">const</span> delNoteHandler = <span class="function">(<span class="params">id</span>) =&gt;</span> &#123;</span><br><span class="line">    dispatch(</span><br><span class="line">      delNote(&#123;</span><br><span class="line">        id,</span><br><span class="line">      &#125;)</span><br><span class="line">    );</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">//更新日记</span></span><br><span class="line">  <span class="keyword">const</span> updateNoteHandler = <span class="function">(<span class="params">id, title, content</span>) =&gt;</span> &#123;</span><br><span class="line">    dispatch(</span><br><span class="line">      updateNote(&#123;</span><br><span class="line">        id,</span><br><span class="line">        title,</span><br><span class="line">        content,</span><br><span class="line">      &#125;)</span><br><span class="line">    );</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">const</span> listItem = noteList.map(<span class="function">(<span class="params">note, index</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;li key=&#123;index&#125;&gt;</span><br><span class="line">        &lt;div className=&#123;style.top&#125;&gt;</span><br><span class="line">          &lt;span&gt;标题：&#123;note.title&#125;&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">          &lt;div&gt;</span></span><br><span class="line"><span class="regexp">            &lt;Button danger type="text" onClick=&#123;() =&gt; delNoteHandler(note.id)&#125;&gt;</span></span><br><span class="line"><span class="regexp">              删除日记</span></span><br><span class="line"><span class="regexp">            &lt;/</span>Button&gt;</span><br><span class="line">            &lt;Button</span><br><span class="line">              danger</span><br><span class="line">              type=<span class="string">"text"</span></span><br><span class="line">              onClick=&#123;() =&gt;</span><br><span class="line">                updateNoteHandler(note.id, <span class="string">"修改日记标题"</span>, <span class="string">"修改日记内容"</span>)</span><br><span class="line">              &#125;</span><br><span class="line">            &gt;</span><br><span class="line">              修改日记</span><br><span class="line">            &lt;<span class="regexp">/Button&gt;</span></span><br><span class="line"><span class="regexp">          &lt;/</span>div&gt;</span><br><span class="line">        &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        &lt;div className=&#123;style.content&#125;&gt;内容：&#123;note.content&#125;&lt;/</span>div&gt;</span><br><span class="line">        &lt;div className=&#123;style[<span class="string">"bottom"</span>]&#125;&gt;</span><br><span class="line">          &lt;span&gt;</span><br><span class="line">            &lt;CheckCircleTwoTone twoToneColor=<span class="string">"#52c41a"</span> /&gt;</span><br><span class="line">            日期：&#123;note.date&#125;</span><br><span class="line">          &lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">          &lt;span&gt;</span></span><br><span class="line"><span class="regexp">            &lt;SmileTwoTone /</span>&gt;</span><br><span class="line">            创建人：&#123;note.creator&#125;</span><br><span class="line">          &lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>div&gt;</span><br><span class="line">      &lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;);</span></span><br><span class="line"><span class="regexp">  return (</span></span><br><span class="line"><span class="regexp">    &lt;div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;div&gt;日记列表&lt;/</span>div&gt;</span><br><span class="line">      &lt;Button</span><br><span class="line">        type=<span class="string">"primary"</span></span><br><span class="line">        onClick=&#123;() =&gt; addNoteHandler(<span class="string">"新增日记标题"</span>, <span class="string">"新增日记内容"</span>)&#125;</span><br><span class="line">      &gt;</span><br><span class="line">        新建日记</span><br><span class="line">      &lt;<span class="regexp">/Button&gt;</span></span><br><span class="line"><span class="regexp">      &lt;ul className=&#123;style["noteList"]&#125;&gt;&#123;listItem&#125;&lt;/u</span>l&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default Note;</span></span><br></pre></td></tr></table></figure>

        
    </section>
</article>



<a id="pagenext" href="/2021/03/15/react-router%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="article-next" title="react-router学习笔记"><i class="icon-arrow-right"></i></a>


<a id="pageprev" href="/2021/03/20/vue3-x%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="article-prev" title="vue3.x学习笔记"><i class="icon-arrow-left"></i></a>



<div class="comments">
    <div id="comments"></div>
    <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
    <script>
    new Gitalk({
        clientID: "7fbe80427f54741e289f",
        clientSecret: "f34ed5fd92e54c9000bd37ba951948cb939deff5",
        repo: "sanonz.github.io",
        owner: "sanonz",
        admin: ["sanonz"],
        id: "2021/03/17/redux学习笔记",
        distractionFreeMode: true,
        title: "redux学习笔记",
        body: "http://yoursite.com/2021/03/17/redux%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/",
        labels: ["react","redux","react-redux"]
    }).render('comments');
    </script>
</div>


            </div>
        </div>
        <footer class="footer">
    Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>, Theme by <a href="https://github.com/sanonz/hexo-theme-concise" target="_blank">Concise</a>

    
    <script>
        var _hmt = _hmt || [];
        (function () {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?e4027971a230b210f4671f485b33846a";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>
    
</footer>

    </main>

    <script type="text/javascript" src="https://cdn.bootcss.com/jquery/1.9.0/jquery.min.js"></script>
    <script type="text/javascript">
    $(function() {
        var nodes = {
            nav: $('#nav'),
            aside: $('#aside'),
            asideInner: $('#aside-inner'),
            navInner: $('#nav-inner')
        };

        var doing = false;
        nodes.asideInner.on('webkitAnimationEnd mozAnimationEnd oAnimationEnd oanimationend animationend', function() {
            if (nodes.aside.hasClass('mobile-open')) {
                nodes.aside.removeClass('mobile-open');
            } else {
                nodes.aside.removeClass('mobile-close panel-show');
            }
            doing = false;
        });
        $('#open-panel, #aside-mask').on('click', function() {
            if (doing) {
                return;
            }

            if (nodes.aside.hasClass('panel-show')) {
                nodes.aside.addClass('mobile-close');
            } else {
                nodes.aside.addClass('mobile-open panel-show');
            }
        });
        $('#open-menus').on('click', function() {
            nodes.navInner.slideToggle();
        });

        if (window.innerWidth <= 960) {
            setTimeout(function() {
                nodes.navInner.slideUp();
            }, 3000);
        }
    });
    </script>
    
        
<script src="/js/scrollspy.min.js"></script>

        <script type="text/javascript">
        $(document.body).scrollspy({target: '#aside-inner'});

        $(window).on('resize', function() {
            var hw = $('#header').width();
            var ww = $('#wrapper').width();
            var space = ($(this).width() - hw - ww) / 2 / 2;

            var pageprev = $('#pageprev');
            var pagenext = $('#pagenext');
            var avg = (pageprev.width() + pagenext.width()) / 2

            if(space > avg) {
                var len = space - avg / 2;
                var styles = {position: 'fixed', top: '50%', marginTop: - (pageprev.width() + pagenext.width()) / 4}
                pageprev.css($.extend({left: hw + len}, styles));
                pagenext.css($.extend({right: len}, styles));
            } else {
                pageprev.removeAttr('style');
                pagenext.removeAttr('style');
            }
        }).trigger('resize');
        </script>
    

</body>

<!--添加的自定义特效-->
<!--点击爱心特效-->
<script type="text/javascript">
var a_idx = 0;
jQuery(document).ready(function($) {
    $("body").click(function(e) {
        var a = new Array("❤不做咸鱼！❤","❤拒绝懒惰！❤","❤想做吃货❤","❤拒绝单身❤","❤向大佬学习❤","❤扶我起来~❤","❤come on❤","❤一直在路上~❤","❤累了~❤","❤再趴一会❤","❤66666❤","❤高兴的飞起*****❤");
        var $i = $("<span></span>").text(a[a_idx]);
        a_idx = (a_idx + 1) % a.length;
        var x = e.pageX,
        y = e.pageY;
        $i.css({
            "z-index": 999999999999999999999999999999999999999999999999999999999999999999999,
            "top": y - 20,
            "left": x,
            "position": "absolute",
            "font-weight": "bold",
            "color": "rgb("+~~(255*Math.random())+","+~~(255*Math.random())+","+~~(255*Math.random())+")"
        });
        $("body").append($i);
        $i.animate({
            "top": y - 180,
            "opacity": 0
        },
        1500,
        function() {
            $i.remove();
        });
    });
});
</script>
<!--背景特效-->
<script type="text/javascript" color="112,128,144" opacity="0.7" zIndex="-2" count="99">
!function(){"use strict";function e(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function t(e,t){return e(t={exports:{}},t.exports),t.exports}var n=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=1;t.default=function(){return""+n++},e.exports=t.default});e(n);var o=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30,n=null;return function(){for(var o=this,i=arguments.length,r=Array(i),a=0;a<i;a++)r[a]=arguments[a];clearTimeout(n),n=setTimeout(function(){e.apply(o,r)},t)}},e.exports=t.default});e(o);var i=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.SizeSensorId="size-sensor-id",t.SensorStyle="display:block;position:absolute;top:0;left:0;height:100%;width:100%;overflow:hidden;pointer-events:none;z-index:-1;opacity:0",t.SensorClassName="size-sensor-object"});e(i);i.SizeSensorId,i.SensorStyle,i.SensorClassName;var r=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.createSensor=void 0;var n,r=(n=o)&&n.__esModule?n:{default:n};t.createSensor=function(e){var t=void 0,n=[],o=(0,r.default)(function(){n.forEach(function(t){t(e)})}),a=function(){t&&t.parentNode&&(t.contentDocument.defaultView.removeEventListener("resize",o),t.parentNode.removeChild(t),t=void 0,n=[])};return{element:e,bind:function(r){t||(t=function(){"static"===getComputedStyle(e).position&&(e.style.position="relative");var t=document.createElement("object");return t.onload=function(){t.contentDocument.defaultView.addEventListener("resize",o),o()},t.setAttribute("style",i.SensorStyle),t.setAttribute("class",i.SensorClassName),t.type="text/html",e.appendChild(t),t.data="about:blank",t}()),-1===n.indexOf(r)&&n.push(r)},destroy:a,unbind:function(e){var o=n.indexOf(e);-1!==o&&n.splice(o,1),0===n.length&&t&&a()}}}});e(r);r.createSensor;var a=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.createSensor=void 0;var n,i=(n=o)&&n.__esModule?n:{default:n};t.createSensor=function(e){var t=void 0,n=[],o=(0,i.default)(function(){n.forEach(function(t){t(e)})}),r=function(){t.disconnect(),n=[],t=void 0};return{element:e,bind:function(i){t||(t=function(){var t=new ResizeObserver(o);return t.observe(e),o(),t}()),-1===n.indexOf(i)&&n.push(i)},destroy:r,unbind:function(e){var o=n.indexOf(e);-1!==o&&n.splice(o,1),0===n.length&&t&&r()}}}});e(a);a.createSensor;var s=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.createSensor=void 0;t.createSensor="undefined"!=typeof ResizeObserver?a.createSensor:r.createSensor});e(s);s.createSensor;var u=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.removeSensor=t.getSensor=void 0;var o,r=(o=n)&&o.__esModule?o:{default:o};var a={};t.getSensor=function(e){var t=e.getAttribute(i.SizeSensorId);if(t&&a[t])return a[t];var n=(0,r.default)();e.setAttribute(i.SizeSensorId,n);var o=(0,s.createSensor)(e);return a[n]=o,o},t.removeSensor=function(e){var t=e.element.getAttribute(i.SizeSensorId);e.element.removeAttribute(i.SizeSensorId),e.destroy(),t&&a[t]&&delete a[t]}});e(u);u.removeSensor,u.getSensor;var c=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.clear=t.bind=void 0;t.bind=function(e,t){var n=(0,u.getSensor)(e);return n.bind(t),function(){n.unbind(t)}},t.clear=function(e){var t=(0,u.getSensor)(e);(0,u.removeSensor)(t)}});e(c);var l=c.clear,d=c.bind,v=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(e){return window.setTimeout(e,1e3/60)},f=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.msCancelAnimationFrame||window.oCancelAnimationFrame||window.clearTimeout,m=function(e){return new Array(e).fill(0).map(function(e,t){return t})},h=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},p=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();var y=function(){function e(t,n){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.randomPoints=function(){return m(o.c.count).map(function(){return{x:Math.random()*o.canvas.width,y:Math.random()*o.canvas.height,xa:2*Math.random()-1,ya:2*Math.random()-1,max:6e3}})},this.el=t,this.c=h({zIndex:-1,opacity:.5,color:"0,0,0",pointColor:"0,0,0",count:99},n),this.canvas=this.newCanvas(),this.context=this.canvas.getContext("2d"),this.points=this.randomPoints(),this.current={x:null,y:null,max:2e4},this.all=this.points.concat([this.current]),this.bindEvent(),this.requestFrame(this.drawCanvas)}return p(e,[{key:"bindEvent",value:function(){var e=this;d(this.el,function(){e.canvas.width=e.el.clientWidth,e.canvas.height=e.el.clientHeight}),this.onmousemove=window.onmousemove,window.onmousemove=function(t){e.current.x=t.clientX-e.el.offsetLeft+document.scrollingElement.scrollLeft,e.current.y=t.clientY-e.el.offsetTop+document.scrollingElement.scrollTop,e.onmousemove&&e.onmousemove(t)},this.onmouseout=window.onmouseout,window.onmouseout=function(){e.current.x=null,e.current.y=null,e.onmouseout&&e.onmouseout()}}},{key:"newCanvas",value:function(){"static"===getComputedStyle(this.el).position&&(this.el.style.position="relative");var e,t=document.createElement("canvas");return t.style.cssText="display:block;position:absolute;top:0;left:0;height:100%;width:100%;overflow:hidden;pointer-events:none;z-index:"+(e=this.c).zIndex+";opacity:"+e.opacity,t.width=this.el.clientWidth,t.height=this.el.clientHeight,this.el.appendChild(t),t}},{key:"requestFrame",value:function(e){var t=this;this.tid=v(function(){return e.call(t)})}},{key:"drawCanvas",value:function(){var e=this,t=this.context,n=this.canvas.width,o=this.canvas.height,i=this.current,r=this.points,a=this.all;t.clearRect(0,0,n,o);var s=void 0,u=void 0,c=void 0,l=void 0,d=void 0,v=void 0;r.forEach(function(r,f){for(r.x+=r.xa,r.y+=r.ya,r.xa*=r.x>n||r.x<0?-1:1,r.ya*=r.y>o||r.y<0?-1:1,t.fillStyle="rgba("+e.c.pointColor+")",t.fillRect(r.x-.5,r.y-.5,1,1),u=f+1;u<a.length;u++)null!==(s=a[u]).x&&null!==s.y&&(l=r.x-s.x,d=r.y-s.y,(v=l*l+d*d)<s.max&&(s===i&&v>=s.max/2&&(r.x-=.03*l,r.y-=.03*d),c=(s.max-v)/s.max,t.beginPath(),t.lineWidth=c/2,t.strokeStyle="rgba("+e.c.color+","+(c+.2)+")",t.moveTo(r.x,r.y),t.lineTo(s.x,s.y),t.stroke()))}),this.requestFrame(this.drawCanvas)}},{key:"destroy",value:function(){l(this.el),window.onmousemove=this.onmousemove,window.onmouseout=this.onmouseout,f(this.tid),this.canvas.parentNode.removeChild(this.canvas)}}]),e}();y.version="2.0.4";var w,b;new y(document.body,(w=document.getElementsByTagName("script"),{zIndex:(b=w[w.length-1]).getAttribute("zIndex"),opacity:b.getAttribute("opacity"),color:b.getAttribute("color"),pointColor:b.getAttribute("pointColor"),count:Number(b.getAttribute("count"))||99}))}();
</script>
</html>
